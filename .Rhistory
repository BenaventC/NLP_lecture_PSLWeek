ggplot(foo1,aes(x=date, y=custom_distrib))+
geom_line(size=1.2,stat="identity")+
labs(title = "Fisc", x=NULL, y=NULL)+
scale_colour_manual(values=c("Orange"," Red", "Darkgreen","Grey"))
#df$text<-str_replace(df$text, "\\w+", "J ") # trouver la solution!!!! pour le '
corpus<-corpus(df,id_field = "id",text_field = "description")
foo<-tokens(corpus,remove_punct = TRUE, remove_symbols=TRUE, remove_numbers=TRUE)%>%
tokens_remove(stopwords("french"))
head(foo,5)
foo1 <-unlist_tokens(foo)
dim(foo1)
foo2<-foo1 %>%
group_by(token)%>%
summarise(n=n())%>%
mutate(rank=rank(desc(n)))
dim(foo2)
ggplot(foo2, aes(x=rank,y=n))+
geom_point(alpha=.2)+geom_smooth(method=lm)+
scale_x_log10()+
scale_y_log10()+
labs(title = "Zipf like")
#with cleaning
dfmat1 <- dfm(foo,
remove = stopwords("french"), remove_punct = TRUE) %>%
dfm_trim(min_termfreq = 3)
textplot_wordcloud(dfmat1, max_words = 50)
dfmat2 <- dfm(corpus_subset(corpus, intitule == "CAF"),
remove = stopwords("french"), remove_punct = TRUE) %>%
dfm_trim(min_termfreq = 3)
textplot_wordcloud(dfmat2, max_words = 150)
t2=Sys.time()
t<- t2-t1
print(t)
knitr::opts_chunk$set(echo = TRUE, include=TRUE, message=FALSE, warning=FALSE)
#from session one
library(tidyverse)
library(udpipe)
library(flextable)
library(cowplot)
library(quanteda)
library(quanteda.textmodels)
library(quanteda.textstats)
library(quanteda.textplots)
library(syuzhet)             #analyse du sentimeent
#for #session 2
library(FactoMineR)
library(factoextra)
library(igraph)
t1=Sys.time()
foo<- dfm %>%
dfm_trim(min_termfreq = 1000, verbose = FALSE)
corpus <- corpus(df$text) # docvars(corpus, field = "doc_id")
summary(corpus)
dfm<- corpus %>%
tokens() %>%dfm()
dfm_df<- as.data.frame(dfm)
dim(dfm_df)
head(dfm,5)
foo<- dfm %>%
dfm_trim(min_termfreq = 1000, verbose = FALSE)
set.seed(100)
textplot_wordcloud(foo)
corpus <- corpus(df$text) # docvars(corpus, field = "doc_id")
corpus <- corpus(df$text) # docvars(corpus, field = "doc_id")
df<-readRDS("UD.rds")%>%
select(doc_id, lemma, upos)%>%
filter(upos=="NOUN"|upos=="PROPN"|upos=="VERB"|upos=="ADJ")%>%
group_by(doc_id)%>%
summarise(text=paste(lemma, collapse=" "))
head(df,5)
corpus <- corpus(df$text) # docvars(corpus, field = "doc_id")
df<-readRDS("UD.rds")%>%
select(doc_id, lemma, upos)%>%
filter(upos=="NOUN"|upos=="PROPN"|upos=="VERB"|upos=="ADJ")%>%
group_by(doc_id)%>%
summarise(text=paste(lemma, collapse=" "))
head(df,5)
corpus <- corpus(df$text) # docvars(corpus, field = "doc_id")
summary(corpus)
dfm<- corpus %>%
tokens() %>% tokens_remove(stopwords("french"))%>%
dfm() %>%
dfm_df<- as.data.frame(dfm)
dfm<- corpus %>%
tokens() %>% tokens_remove(stopwords("french"))%>%
dfm()
dfm_df<- as.data.frame(dfm)
dfm_df<- as.data.frame(dfm)
dim(dfm_df)
head(dfm,5)
head(dfm,5)
foo<- dfm %>%
dfm_trim(min_termfreq = 1000, verbose = FALSE)
set.seed(100)
textplot_wordcloud(foo)
foo<- dfm %>%
dfm_trim(min_termfreq = 500, verbose = FALSE)
foo<- dfm %>%
dfm_trim(min_termfreq = 100, verbose = FALSE)
set.seed(100)
textplot_wordcloud(foo)
dfm_df<- as.data.frame(foo)
dim(dfm_df)
head(dfm,5)
res.mca <- MCA(dfm_fr,
graph=TRUE)
res.mca <- MCA(dfm_df,
graph=TRUE)
res.mca <- MCA(dfm_df, ncp=5,
graph=TRUE)
View(dfm_df)
dfm_df<- as.data.frame(foo) %>%column_to_rownames(doc_id)
foo<- dfm %>%
dfm_trim(min_termfreq = 100, verbose = FALSE)
set.seed(100)
textplot_wordcloud(foo)
dfm_df<- as.data.frame(foo) %>% column_to_rownames(doc_id)
dfm_df<- as.data.frame(foo)
foo1<- dfm_df %>% column_to_rownames(doc_id)
foo1<- dfm_df %>% column_to_rownames(var=doc_id)
foo1<- dfm_df %>%
column_to_rownames(var="doc_id")
res.mca <- MCA(dfm_df, ncp=5,
graph=TRUE)
res.mca <- MCA(foo1, ncp=5,
graph=TRUE)
res.mca <- MCA(foo1, ncp=5,
graph=TRUE)
res.mca <- MCA(foo1[,c(1:1030)], ncp=5,graph=TRUE)
res.mca <- PCA(foo1[,c(1:1030)], ncp=5,graph=TRUE)
foo<-res.pca$var$coord
res.pca <- PCA(foo1[,c(1:1030)], ncp=5,graph=FALSE)
foo<-res.pca$var$coord
View(foo)
View(foo)
foo1<-res.pca$var$coord %>%
mutate(label=rownames_to_column())%>%
filter((Dim.1>.5 | Dim.1>.5) & (Dim.2>.5 | Dim.2>.5))
foo1<-res.pca$var$coord
foo1<-as.data.frame(res.pca$var$coord)%>%
mutate(label=rownames_to_column())%>%
filter((Dim.1>.5 | Dim.1>.5) & (Dim.2>.5 | Dim.2>.5))
foo1<-as.data.frame(res.pca$var$coord) %>%
mutate(label=rownames_to_column())
foo1<-as.data.frame(res.pca$var$coord)
View(foo)
View(foo1)
foo1 <-foo1 %>%
mutate(label=rownames_to_column())
foo1 <-foo1 %>% rownames_to_column()
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column()
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column() %>%
filter((Dim.1>.5 | Dim.1>.5) & (Dim.2>.5 | Dim.2>.5))
View(foo1)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var=label) %>%
filter((Dim.1>.5 | Dim.1>.5) & (Dim.2>.5 | Dim.2>.5))
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter((Dim.1>.5 | Dim.1>.5) & (Dim.2>.5 | Dim.2>.5))
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label")
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter((Dim.1>.3 | Dim.1>.3) & (Dim.2>.3 | Dim.2>.5))
View(foo1)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label")
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter((Dim.1>.3 | Dim.1>.3) | (Dim.2>.3 | Dim.2>.5))
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter((Dim.1>.3 | Dim.1>.3) | (Dim.2>.3 | Dim.2>.3))
ggplot(foo1, aes(x=Dim.1, y=Dim.2)+geom_label(aes(label=label))
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label))
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter((Dim.1>.3 | Dim.1< -.3) | (Dim.2>.3 | Dim.2> - .3))
# label selection factor
a=.5
foo<- dfm_df %>%
column_to_rownames(var="doc_id")
res.pca <- PCA(foo[,c(1:1030)], ncp=5,graph=FALSE)
res.pca <- PCA(foo[,c(1:1030)], ncp=5,graph=FALSE)
# label selection factor
a=.5
foo<- dfm_df %>%
column_to_rownames(var="doc_id")
res.pca <- PCA(foo[,c(1:1030)], ncp=5,graph=FALSE)
res.pca <- PCA(foo[,c(1:1030)], ncp=5,graph=FALSE)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2> - a)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2> - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label))
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label))
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
# label selection factor
a=.5
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2> - a)
# label selection factor
a=.7
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
# label selection factor
a=.6
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
# label selection factor
a=.5
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
# label selection factor
a=.4
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
# label selection factor
a=.35
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.3>a | Dim.3< -a | Dim.4>a | Dim.4< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.3> a | Dim.3< -a | Dim.4> a | Dim.4< -a)
# label selection factor
a=.3
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.3> a | Dim.3< -a | Dim.4> a | Dim.4< -a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
resKM <- kmeans(t(res.pca), nstart = 20)
resKM <- kmeans(t(res.pca), 8, nstart = 10, trace=1)
View(res.mca)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%t()
View(foo1)
foo1<-as.data.frame(res.pca$var$coord)
resKM <- kmeans(foo1, 8, nstart = 10, trace=1)
foo<-resKM$cluster
foo<-as.data.frame(resKM$cluster)
View(foo)
foo<-as.data.frame(resKM$cluster) %>%rename(cluster=1)%>%rownames_to_column(var(word))
foo<-as.data.frame(resKM$cluster) %>%rename(cluster=1)%>%
rownames_to_column(var("word"))
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>%
rownames_to_column(var("word"))
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>%
rownames_to_column(var="word")
dfm_count<-dfm_df %>%pivot_longer(-doc_id,names_to = "Word", values_to = "n")
dfm_count<-dfm_df %>%
pivot_longer(-doc_id,names_to = "Word", values_to = "n")%>%
group_by(Word)%>%
summarise(Doc_frequency=n(),Term_frequency=sum(n))
View(dfm_count)
dfm_count<-dfm_df %>%
pivot_longer(-doc_id,names_to = "Word", values_to = "n")%>%
group_by(Word)%>% mutate(m=1)%>%
summarise(Doc_frequency=sum(m),
Term_frequency=sum(n))
dim(dfm_df)
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>%
rownames_to_column(var="Word") %>%left_join(dfm_count)
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>% as.factor(cluster)
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>% as.factor(cluster) %>%
rownames_to_column(var="Word") %>%left_join(dfm_count)
foo$cluster<-foo$cluster
foo$cluster<-as.factor(foo$cluster)
ggplot(foo, aes(label = Word, size = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 20) +
theme_minimal()
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 20) +
theme_minimal()
library(ggwordcloud)
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 20) +
theme_minimal()
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 20) +
facet_wrap(vars(cluster), ncol=4)
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 10) +
facet_wrap(vars(cluster), ncol=4)
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 8) +
facet_wrap(vars(cluster), ncol=4)+theme_minimal()
library(FactoMineR)
foo<- dfm_df %>%
column_to_rownames(var="doc_id")
#PCA
res.pca <- PCA(foo[,c(1:1030)], ncp=5,graph=FALSE)
#label selection factor
a=.3
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.3> a | Dim.3< -a | Dim.4> a | Dim.4< -a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
#typo with kmnes
foo1<-as.data.frame(res.pca$var$coord)
resKM <- kmeans(foo1, 12, nstart = 10, trace=1)
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>%
rownames_to_column(var="Word") %>%left_join(dfm_count)
foo$cluster<-as.factor(foo$cluster)
set.seed(42)
library(ggwordcloud)
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 8) +
facet_wrap(vars(cluster), ncol=4)+theme_minimal()
knitr::opts_chunk$set(echo = TRUE, include=TRUE, message=FALSE, warning=FALSE)
#from session one
library(tidyverse)
library(udpipe)
library(flextable)
library(cowplot)
library(quanteda)
library(quanteda.textmodels)
library(quanteda.textstats)
library(quanteda.textplots)
library(syuzhet)             #analyse du sentimeent
#for #session 2
library(FactoMineR)
library(factoextra)
library(igraph)
t1=Sys.time()
#read the file and select tokens
df<-readRDS("UD.rds")%>%
select(doc_id, lemma, upos)%>%
filter(upos=="NOUN"|upos=="PROPN"|upos=="VERB"|upos=="ADJ")%>%
group_by(doc_id)%>%
summarise(text=paste(lemma, collapse=" "))
head(df,5)
#ajouter les variables doc_var
corpus <- corpus(df$text) # docvars(corpus, field = "doc_id")
summary(corpus)
dfm<- corpus %>%
tokens() %>% tokens_remove(stopwords("french"))%>%
dfm()
dfm<- dfm %>%
dfm_trim(min_termfreq = 100, verbose = FALSE)
set.seed(100)
textplot_wordcloud(dfm)
dfm_df<- as.data.frame(dfm)
dim(dfm_df)
head(dfm,5)
dfm_count<-dfm_df %>%
pivot_longer(-doc_id,names_to = "Word", values_to = "n")%>%
group_by(Word)%>% mutate(m=1)%>%
summarise(Doc_frequency=sum(m),  #une erreur à vérifier
Term_frequency=sum(n))
library(FactoMineR)
foo<- dfm_df %>%
column_to_rownames(var="doc_id")
#PCA
res.pca <- PCA(foo[,c(1:1030)], ncp=5,graph=FALSE)
#label selection factor
a=.3
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.3> a | Dim.3< -a | Dim.4> a | Dim.4< -a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
#typo with kmnes
foo1<-as.data.frame(res.pca$var$coord)
resKM <- kmeans(foo1, 12, nstart = 10, trace=1)
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>%
rownames_to_column(var="Word") %>%left_join(dfm_count)
foo$cluster<-as.factor(foo$cluster)
set.seed(42)
library(ggwordcloud)
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 8) +
facet_wrap(vars(cluster), ncol=4)+theme_minimal()
knitr::opts_chunk$set(echo = TRUE, include=TRUE, message=FALSE, warning=FALSE)
#from session 1
library(tidyverse)
library(udpipe)
library(flextable)
library(cowplot)
library(quanteda)
library(quanteda.textmodels)
library(quanteda.textstats)
library(quanteda.textplots)
library(syuzhet)  #analyse du sentimeent
# new for session 2
library(FactoMineR)
library(factoextra)
library(igraph)
library(ggwordcloud)
library(Rtsne)
theme_set(theme_minimal())
t1=Sys.time()
#read the file and select tokens
df<-readRDS("UD.rds")%>%
select(doc_id, lemma, upos)%>%
filter(upos=="NOUN"|upos=="PROPN"|upos=="VERB"|upos=="ADJ")%>%
group_by(doc_id)%>%
summarise(text=paste(lemma, collapse=" "))
head(df,5)
#ajouter les variables doc_var
corpus <- corpus(df$text) # docvars(corpus, field = "doc_id")
summary(corpus)
dfm<- corpus %>%
tokens() %>% tokens_remove(stopwords("french"))%>%
dfm()
dfm<- dfm %>%
dfm_trim(min_termfreq = 100, verbose = FALSE)
set.seed(100)
textplot_wordcloud(dfm)
dfm_df<- as.data.frame(dfm)
dim(dfm_df)
head(dfm,5)
dfm_count<-dfm_df %>%
pivot_longer(-doc_id,names_to = "Word", values_to = "n")%>%
group_by(Word)%>% mutate(m=1)%>%
summarise(Doc_frequency=sum(m),  #une erreur à vérifier
Term_frequency=sum(n))
library(FactoMineR)
foo<- dfm_df %>%
column_to_rownames(var="doc_id")
#PCA
res.pca <- PCA(foo[,c(1:1030)], ncp=5,graph=FALSE)
#label selection factor
a=.3
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.1>a | Dim.1< -a | Dim.2>a | Dim.2< - a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
foo1<-as.data.frame(res.pca$var$coord) %>%
rownames_to_column(var="label") %>%
filter(Dim.3> a | Dim.3< -a | Dim.4> a | Dim.4< -a)
ggplot(foo1, aes(x=Dim.1, y=Dim.2))+
geom_text(aes(label=label),size=2)
#typo with kmnes
foo1<-as.data.frame(res.pca$var$coord)
resKM <- kmeans(foo1, 12, nstart = 10, trace=1)
foo<-as.data.frame(resKM$cluster) %>%
rename(cluster=1)%>%
rownames_to_column(var="Word") %>%left_join(dfm_count)
foo$cluster<-as.factor(foo$cluster)
set.seed(42)
library(ggwordcloud)
ggplot(foo, aes(label = Word, size=Term_frequency, group = cluster)) +
geom_text_wordcloud() +
scale_size_area(max_size = 8) +
facet_wrap(vars(cluster), ncol=4)+theme_minimal()
t2=Sys.time()
t<- t2-t1
print(t)
